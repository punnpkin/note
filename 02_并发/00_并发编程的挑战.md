# 并发编程的挑战

## 1. 上下文切换

CPU通过时**间片分配算法**来循环执行任务，当前任务执行一个时间片后会切换到下一个任务。但是，在切换前会保存上一个任务的状态，以便下次切换回这个任务时，可以再加载这个任务的状态。任务从保存到再加载的过程就是**一次上下文切换**。

上下文切换的开销在任务比较小的时候，是比较耗时的。

减少上下文切换的方法：

- 无锁并发：避免竞争锁
- CAS算法
- 使用最少线程
- 协程：在单线程里实现多任务调度

## 2. 死锁

两个线程互相等待对方释放锁

避免死锁的方法：

- 避免一个线程同时获取多个锁
- 避免一个线程在锁内同时占用多个资源
- 尝试使用定时锁
- 数据库锁的加锁和解锁要在同一个数据库连接里

## 3. 资源限制

硬件资源限制有带宽的上传/下载速度、硬盘读写速度和CPU的处理速度。

软件资源限制有数据库的连接数和socket连接数等。





